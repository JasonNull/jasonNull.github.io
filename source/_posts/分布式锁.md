---
title: 分布式锁
date: 2018-06-24 16:04:56
tags:
- 分布式
- 锁
categories:
- 分布式
toc: true
---
#### 数据库锁
select for update
##### 优点
1. 借助数据库行锁机制容易理解
2. 宕机自动释放

##### 缺点
1. 性能不高
2. 不支持重入
3. 长时间占有锁可能会导致连接池打爆
4. 并不一定是锁行，如果表比较小的情况下，可能会直接锁表
<!-- more -->

#### redis
key -> 主机id + 线程id + 重入数量，随便添加一个过期时间
判断一下前面是否相同
redisson通过lua脚本，完成以上功能，然后应该是利用redis的key notification功能
##### 优点
1. 单次加锁性能好
2. 实现起来方便

##### 缺点
1. 超时控制锁的释放有问题，不能宕机自动释放

#### zookeeper
利用zk的临时节点的特性，在某个目录下面生成瞬时有序的临时节点，然后判断下节点是否是最小的。释放时候，只要将当前节点删除即可。
##### 优点
1. 锁可以自动释放，客户端断开连接，临时节点会自动删除
2. 可以利用zk的监听机制，实现阻塞锁
3. 可重入，将当前线程信息写入到节点中
4. zk集群部署，避免单点问题
##### 缺点
1. 性能不如redis

可靠性
zk > redis > mysql

性能
redis > zk > mysql

实现难度
mysql > redis > zk