---
title: 语法糖
date: 2018-06-23 16:20:25
tags:
- java
- 基础
categories:
- java
- 基础
toc: true
---
## 1. switch支持String
通过String对象的hashCode以及equals来实现

## 2. 泛型
泛型的支持有两种方案`code specialization`和`code sharing`
C++和C#是实现的第一种方式，编译出来的代码生成了很多的模板类
java使用的是code sharing，编译器在编译的时候，执行了泛型擦除（type erasure)

## 3. 自动装箱与拆箱
自动装箱是插入`Integer.valueOf(123)`实现的
自动拆箱是插入`new Integer(123).intValue()`实现的
<!-- more -->
## 4. 方法变长参数
通过数组来实现的

## 5. 枚举
enum枚举通过继承Enum类来完成的

## 6. 匿名内部类
匿名内部类在编译之后是一个完全独立的类，例子BeanContext中的第一个内部类就是BeanContext$1.class

## 7. 条件编译
编译器优化，把那些100%不会执行的代码优化掉。
```java
int a = 0;
if (a > 0) {
} else if (a >= 0) {
}
```
编译过后，代码块1不会被编译进去。

## 8. 断言
`assert a == b;`  
被编译成下面类似代码段
```
if(!$assertionsDisabled && a != b) 
    throw new AssertionError(); 
```

## 9. 数值字面量
`100_000`编译后会成为`100000`

## 10. for-each
```java
List<String> list = Arrays.asList("1", "2", "3");
for (String str : list) {
} 
```
编译为
```
String str;
for (Iterator<String> ite = list.iterator(); ite.hasNext(); str = ite.next()) {

}
```
11. try-with-resource
```
try (InputStream inputStream = new FileInputStream("test.txt")) {
    // doSomething
} catch (Exception e) {
    // doSomething too
} 
```
编译后
```
Throwable t;
try {
    InputStream inputStream = new FileInputStream("test.txt");
    try {
        // doSomething
    } catch (Throwable t1) {
        t = t1;
        throw t;
    } finally {
        if (inputStream != null) {
            if (t != null) {
                try {
                    inputStream.close();
                } catch (Throwable t2) {
                    t1.addSuppressed(t2);
                }
            } else {
                inputStream.close()
            }
        }
    }
} catch (IOException e1) {
}
```


## 11. Lambda表达式
lambda其实是个static方法
`new Thread(() -> {})` 
编译后
```java
class SomeClass {
    void someFunc() {
        new Thread(SomeClass::someFunction);
    }

    private static void someFunction() {
        
    }
}
```

## 12. foreach循环
目标类实现Iterable接口
```java
Class A implements Iterable<String>{}
    void someFunc() {
        for (String str : new A()) {
        }
    }
```
被编译为
```java
Stringvar2;
for(Iteratorvar1=(new A()).iterator(); var1.hasNext(); var2=(String)var1.next()) {
}
```
