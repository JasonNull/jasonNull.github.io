---
title: 类加载
date: 2018-06-23 16:07:40
tags:
- java
- jvm
categories:
- java
- jvm
toc: true
---

#### 流程
1. 加载
    - 通过类名寻找到class文件 
    - 构建class对象
    - 将class文件变为运行时数据结构
2. 验证
    - 文件格式验证，文件格式是不是符合当前虚拟机规范
    - 元数据验证，语义分析 
    - 字节码验证，字节码是否符合规范，是否会对虚拟机造成危害
    - 符号引用验证，
3. 准备
    - 为变量分配内存，并且赋默认值（0，null，false）
4. 解析
    - 类和接口的解析，这边可能涉及到其他类的加载
    - 字段解析（静态，非静态）
    - 方法解析
5. 初始化
    - 执行静态变量的初始赋值，和类内静态代码块
6. 使用
7. 卸载

<!-- more -->
#### 加载器
1. bootstrap，加载JDK\jre\lib或者-Xbootclasspath下面的类，如rt.jar，java.*开头的类
2. extension，加载JDK\jre\lib\ext或者由java.ext.dirs系统变量
3. system，加载classpath下面的所有路径

#### 父类委托
1. 更安全，这样防止自定义ClassLoader加载系统类
2. 防止同一个class被加载两次

#### tip
1. 类内代码块的执行早过构造函数，因为编译的时候把类内代码块移到了构造函数首部。
2. 如何解决jar包冲突，具体是类隔离，不同的jar包通过不同的技术加载