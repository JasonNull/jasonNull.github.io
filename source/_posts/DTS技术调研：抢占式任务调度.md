---
title: DTS技术调研：抢占式任务调度
date: 2018-07-07 18:25:41
tags:
- 中间件
categories:
- 中间件
toc: true
---
### 任务调度
任务调度常见于操作系统，用于调度操作系统的线程，目的是更高的资源利用率，更高的性能，以及更快的系统响应速度。
调度方式主要分类如下：
- 轮询调度，类似均田制，按线程来获取分配时间，用途比较少，会造成一定程度上的资源浪费等
- 抢占式调度，类似按需分配，根据优先级来划分线程执行时间，资源利用率很高，但是会造成一定程度的线程饥渴问题（主要看调度算法的优化）
<!-- more -->

### 现有调度策略
1. 随机任务：将任务分发到集群的任意一台机器（不需要调度策略）
2. 广播任务：将任务分发到集群的所有机器上（不需要调度策略）
3. 分片广播任务：将任务分片，假设任务为n，机器数为m，每台机器上的任务为n/m（使用轮询调度策略）
    - 优点：开发简单，只要将任务均匀分发到各台机器上
    - 缺点：业务方需要将任务切割的比较均匀，不然可能会导致任务对资源的利用率不高

### 优化调度策略
整体改为抢占式任务调度，提升整体资源利用率，架构如下:
![架构](/images/DTS分发架构.png)

分发流程整体如下：
<img src="/images/抢占式任务调度.png" height="50%" width="50%"/>

### 难点
如何确定客户端一次获取的任务数量z的大小？
- 任务总数量n
- 客户端数量m
- 客户端核心数量x
- 客户端线程数量y

分为以下情况：
1. n >> m * y的情况下，z = 2 * y
2. n > m * y的情况下，z初始为y，后续利用下面的算法
3. x * m < n < m * y的情况下，z = x
4. n < x * m的情况下，z = n / m